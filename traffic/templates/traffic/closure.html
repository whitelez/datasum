{% extends "traffic/base.html" %}{% load staticfiles %}{% block title %}MDAP - Road Closure{% endblock %}{% block style %} <style>html { font-size: 12px; font-family: Arial, Helvetica, sans-serif; }</style>    <link rel="stylesheet" href="http://cdn.kendostatic.com/2014.3.1411/styles/kendo.common.min.css" />    <link rel="stylesheet" href="http://cdn.kendostatic.com/2014.3.1411/styles/kendo.default.min.css" />    <link rel="stylesheet" type="text/css" href="{% static 'traffic/bootstrap_patch.css'%}"><link rel="stylesheet" href="{% static 'traffic/leaflet-search.css' %}"><link rel="stylesheet" href="{% static 'traffic/style_closure.css' %}"><style>    #to-do .k-datetimepicker {margin-right:20px;margin-left:20px;}</style>{% endblock %}{##############################################################}{% block content %}<div id='user_input' class="well" style="height:100%;"><div class="container" style="width: inherit">    <div class="row" style="margin-top:10px;margin-right:auto;margin-left: 20px;"> <h3> Road Closure Inquiry</h3> </div>    <br>   <div id="timepick">        <div id="to-do" style="margin-left:0px;width:100%;">            <input id="datetimepicker" />        </div>    </div></div>    <br><a type="button" class="btn btn-blue" id="check_btn" style="margin-top:10px;margin-right:10px;width:90%;">   <span class="glyphicon glyphicon-search"> </span> &nbsp; Inquiry </a> <br>{#<input type="button" value="Update" />#}<a href="#" type="button" class="btn btn-red" id="reset_btn" style="margin-top:10px; margin-right:10px;width:90%;">   <span class="glyphicon glyphicon-search"> </span> &nbsp; Now closed </a> <br></div>{#<p id="txtHint"></p>#}{% endblock %}{##############################################################}{% block map %}{#  iv id="dataT" style="display: none;" >  #}{#   name="mytab" id="datatab">             #}{#   for point in points %}                 #}{#    <tr>                                  #}{#        <td>{{ point.lat }}</td>          #}{#        <td>{{ point.lng }}</td>          #}{#        <td>{{ point.note }}</td>         #}{#        <td>{{ point.location }}</td>     #}{#    </tr>                                 #}{#   endfor %}                              #}{#  e>                                      #}{#                                          #}	<div id="map"></div>{#	<div id="chart">#}{#     	<div id="chart1" style="height:250px;width:97%;margin-left: 20px;margin-right: 20px "></div>#}{#	</div>#}{% endblock %}{##############################################################}{% block script %}<script type="text/javascript" src="{% static 'traffic/modernizr-1.5.min.js' %}"></script><script type="text/javascript" src="{% static 'traffic/leaflet-search.min.js' %}"></script><script src="http://cdn.kendostatic.com/2014.3.1411/js/jquery.min.js"></script><script src="http://cdn.kendostatic.com/2014.3.1411/js/kendo.all.min.js"></script><script>    var markers;    var lines;    var mm;    var yy;    var dd;    var weekday;    var hour;    function updateime(){        var d = new Date($("#datetimepicker").data("kendoDateTimePicker").value());        mm = d.getMonth()+1;        yy = d.getFullYear();        dd = d.getDate();        var day = d.getDay();        if (day==0 || day == 6){            weekday = 0;        }        else weekday = 1;        hour = d.getHours();    }    function parkingMarkerStyle(i){        if (i==1) {            return {                radius: 4,                fillColor: "#2510E6",                weight: 1,                opacity: 0.7,                fillOpacity: 0.7            };        }        else {            return {                radius: 4,                fillColor: 'red',                weight: 1,                opacity: 1,                fillOpacity: 0.9            };        }	}    var table = document.getElementById("datatab");    var map = null;    $(document).ready(function(){    map = L.map('map').setView([40.446428,-79.9537934], 12);	// add an OpenStreetMap tile layer	L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {		attribution: '&copy; <a href="http://osm.ggorg/copyright">OpenStreetMap</a> contributors'	}).addTo(map);		map.addControl( new L.Control.Search({			url: 'http://nominatim.openstreetmap.org/search?format=json&q={s}',			jsonpParam: 'json_callback',			propertyName: 'display_name',			propertyLoc: ['lat','lon'],			markerLocation: true,			autoType: false,			autoCollapse: true,			minLength: 2,			zoom:10		}) );         markers = [];         lines = [];         $.get("../get_road_closure_query/", {mm:mm, dd:dd, yy:yy, hour:hour, weekday:weekday, first:1}, function(input, textStatus){            plotnewpoints(input);		},"json");        $("#datetimepicker").kendoDateTimePicker({            value:new Date()        });        var datetimepicker = $("#datetimepicker").data("kendoDateTimePicker");        datetimepicker.value(new Date());	});    $('#check_btn').click(function(){        updateime();        markersdel();	    $.get("../get_road_closure_query/", {mm:mm, dd:dd, yy:yy, hour:hour, weekday:weekday, first:0}, function(input, textStatus){            plotnewpoints(input);		},"json");	});    $('#reset_btn').click(function(){        var datetimepicker = $("#datetimepicker").data("kendoDateTimePicker");        datetimepicker.value(new Date());        updateime();        markersdel();	    $.get("../get_road_closure_query/", {mm:mm, dd:dd, yy:yy, hour:hour, weekday:weekday, first:0}, function(input, textStatus){            plotnewpoints(input);		},"json");	});    function plotnewpoints(datain){        for (var i = 0; i < datain.points.length; i++) {            if (datain.points[i].fields.type == 1) {                var LamMarker = L.circleMarker([datain.points[i].fields.lat, datain.points[i].fields.lng], parkingMarkerStyle(1));                markers.push(LamMarker);                LamMarker.addTo(map)                .bindPopup('<b>Location: </b>' + datain.points[i].fields.location + '<br> <b>Close Reason: </b>' +datain.points[i].fields.note+                '<br> <b>Close period: </b>' +datain.points[i].fields.start_date+ ' to ' +datain.points[i].fields.end_date+                '<br> <b>Weekday hours: </b>' +datain.points[i].fields.wkday_hrsfull+                '<br> <b>Weekend hours: </b>' +datain.points[i].fields.wkend_hrsfull);            }            else {                var lineraw = datain.points[i].fields.rdline.split("#");                var arrayLength = lineraw.length;                var pointlist = [];                for (var j = 0; j < arrayLength; j++) {                    var po = lineraw[j].split("_");                        pointlist.push(new L.LatLng(po[1], po[0]));                    if(po[1]<35){                        console.log(datain.points[i]);                        console.log(datain.points[i].fields.pk);                    }                }                var ployline = new L.Polyline(pointlist, { color: '#7654F0',                                                            weight: 4,                                                            opacity: 0.7,                                                            smoothFactor: 1                                                            });                lines.push(ployline);                ployline.addTo(map)                .bindPopup('<b>Location: </b>' + datain.points[i].fields.location + '<br> <b>Close Reason: </b>' +datain.points[i].fields.note+                '<br> <b>Close period: </b>' +datain.points[i].fields.start_date+ ' to ' +datain.points[i].fields.end_date+                '<br> <b>Weekday hours: </b>' +datain.points[i].fields.wkday_hrsfull+                '<br> <b>Weekend hours: </b>' +datain.points[i].fields.wkend_hrsfull);            }        }    }function markersdel() {    for(i=0;i<markers.length;i++) {        map.removeLayer(markers[i]);    }    markers = [];    for(i=0;i<lines.length;i++) {        map.removeLayer(lines[i]);    }    lines = [];}  </script>{% endblock %}